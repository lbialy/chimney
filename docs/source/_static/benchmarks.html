<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chimney benchmarks!</title>
    <link rel="stylesheet" href="pygments.css" type="text/css" />
    <link rel="stylesheet" href="css/theme.css" type="text/css" />
    <!--[if lt IE 9]>
    <script src="js/html5shiv.min.js"></script>
    <![endif]-->

    <script data-url_root="./" id="documentation_options" src="documentation_options.js"></script>
    <script src="jquery.js"></script>
    <script src="underscore.js"></script>
    <script src="_sphinx_javascript_frameworks_compat.js"></script>
    <script src="doctools.js"></script>
    <script src="sphinx_highlight.js"></script>
    <script src="js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Index" href="index.html" />
    <style>
        .benchmarks-content {
            min-width: 100%;
        }
    </style>
</head>

<body class="wy-body-for-nav">
<div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search" >
                <a href="#" class="icon icon-home">Chimney</a>
                <div class="version">
                    benchmarks
                </div>
                <div role="search">
                    <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
                        <input type="text" name="q" placeholder="Search docs" />
                        <input type="hidden" name="check_keywords" value="yes" />
                        <input type="hidden" name="area" value="default" />
                    </form>
                </div>
            </div>
            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
                <p class="caption" role="heading"><span class="caption-text">Navigation</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">Back to docs</a></li>
                </ul>
            </div>
            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
                <p class="caption" role="heading"><span class="caption-text">Comparison benchmarks</span></p>
                <ul id="benchmarks-menu">

                </ul>
            </div>
        </div>
    </nav>
    <iframe id="benchmarks-window" class="wy-nav-content-wrap benchmarks-content"></iframe>
</div>
<script>
    jQuery(function () {
        SphinxRtdTheme.Navigation.enable(true);
    });

    function sliding(l, xs, i = 0, out = []) {
        return i > xs.length - l ? out : sliding(l, xs, i + 1, [...out, xs.slice(i, i + l)])
    }

    // this is the benchmark loading part!
    (function() {
        // TODO LB change props
        const org = 'lbialy'
        const repo = 'chimney-test'
        const branch = 'main'

        const $iframe = $('#benchmarks-window')
        const $menu = $('#benchmarks-menu')

        const benchmarkResultRE = /\d{8}-([0-9a-fA-F]{7})\.json/

        const addNavEntry = (name, onClick) => {
            const el = $(`<li class="toctree-l1"><a class="reference internal">${name}</a></li>`)
            el.click(onClick)
            $menu.append(el)
        }
        const dataUrl = (org, repo, branch, filename) => `https://raw.githubusercontent.com/${org}/${repo}/${branch}/${filename}`
        const queryUrl = (org, repo, branch) => `https://api.github.com/repos/${org}/${repo}/git/trees/${branch}`
        const iframeUrl = (urls) => `https://jmh.morethan.io/?sources=${urls.join(',')}`

        const fetchResults = (org, repo, branch) => fetch(queryUrl(org, repo, branch)).then(response => response.json())

        fetchResults(org, repo, branch)
            .then(resultsJson => {
                const benchmarkResultFileNames =
                    resultsJson.tree
                        .map(_ => _.path) // this assumes results are in root repo dir
                        .filter(_ => benchmarkResultRE.test(_))
                        .reverse() // newest first

                let firstGroup = true

                sliding(3, benchmarkResultFileNames) // how many commits are being compared
                    .forEach(group => {
                        const hashes = group.map(fileName => fileName.match(benchmarkResultRE)[1])
                        const first = hashes[0]
                        const last = hashes[group.length - 1]

                        const navBenchmarkName = `${first} .. ${last}`

                        const iframeSrc = iframeUrl(group.map(fileName => dataUrl(org, repo, branch, fileName)))

                        addNavEntry(navBenchmarkName, ev => {
                            ev.preventDefault()
                            $iframe.attr('src', iframeSrc)
                        })

                        if (firstGroup) {
                            $iframe.attr('src', iframeSrc)
                            firstGroup = false
                        }
                    })
            })
    })()
</script>
<!-- Theme Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-116165806-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-116165806-1', {
        'anonymize_ip': false,
    });
</script>

</body>
</html>